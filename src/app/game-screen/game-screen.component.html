<div class="grid place-items-center min-h-full p-4">
  <div class="flex gap-2 place-self-start">
    <button
      mat-mini-fab
      color="primary"
      matTooltip="Leave room"
      (click)="game.room!.leave()"
    >
      <mat-icon>logout</mat-icon>
    </button>

    <button
      mat-mini-fab
      color="primary"
      matTooltip="Copy room link to clipboard"
      [cdkCopyToClipboard]="location.href.split('?')[0]"
    >
      <mat-icon>link</mat-icon>
    </button>

    <button
      *ngIf="game.player?.admin"
      mat-mini-fab
      color="primary"
      matTooltip="You are the room's admin"
    >
      <mat-icon>star</mat-icon>
    </button>

    <button
      *ngIf="game.isDealer"
      mat-mini-fab
      color="accent"
      matTooltip="You are the dealer this hand"
    >
      <mat-icon>casino</mat-icon>
    </button>
  </div>

  <div class="grid place-items-center py-8 w-min">
    <!-- ADD this new div for trick cards at the very top -->
    <div
      class="absolute left-1/2 transform -translate-x-1/2 z-20"
      style="top: 15%"
    >
      <!-- Show played cards in current trick -->
      <div
        *ngIf="
          game.room!.state.currentTrick &&
          game.room!.state.currentTrick.length > 0
        "
        class="table-font text-amber-50 font-serif text-center"
      >
        <div class="font-bold mb-2">
          Trick {{ game.room!.state.currentTrickNumber }}
        </div>
        <div class="flex justify-center gap-2 flex-wrap">
          <div
            *ngFor="let playedCard of game.room!.state.currentTrick"
            class="flex flex-col items-center"
          >
            <app-card [card]="playedCard.card" class="scale-75"></app-card>
            <span class="text-xs mt-1">
              {{ getPlayerName(playedCard.playerId) }}
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="player-holder row-start-1 col-start-1">
      <app-player
        *ngFor="let player of getAllPlayers(smallScreen$ | async); index as i"
        [style.z-index]="10 - Math.round(getPlayerPosition(i) * 10)"
        [player]="player"
        [endTimestamp]="game.roundEndTimestamp"
        [isPlayerTurn]="
          game.room!.state.currentTurnPlayerId === player?.sessionId
        "
        [clientIsPlayer]="game.room!.sessionId === player?.sessionId"
        [scoreBottom]="
          (smallScreen$ | async) ||
          (getPlayerPosition(i) <= 0.25 && getPlayerPosition(i) != 0)
        "
        [isDealer]="player?.sessionId === game.room!.state.dealerId"
        (playCard)="game.playCard($event)"
        (kick)="game.kick($event)"
      ></app-player>
    </div>

    <div
      class="row-start-1 col-start-1 z-0 text-amber-50 font-serif text-center"
    >
      <span class="table-font-xl">Swick</span><br />
      <span class="table-font-lg">Knock In, Play Bold, Don't Go Set</span>

      <!-- Show trump card during trump selection phase -->
      <div
        *ngIf="game.room!.state.trumpCard && game.trumpSelectionPhase"
        class="table-font mt-2"
      >
        <div class="font-bold mb-2">Trump Card:</div>
        <div class="flex justify-center">
          <app-card [card]="game.room!.state.trumpCard"></app-card>
        </div>
      </div>

      <!-- Show trump suit once selected -->
      <div
        *ngIf="game.room!.state.trumpSuit && !game.trumpSelectionPhase"
        class="table-font mt-2"
      >
        Trump: {{ game.room!.state.trumpSuit }}
      </div>
      <div *ngIf="game.room!.state.potValue > 0" class="table-font mt-1">
        Pot: {{ game.room!.state.potValue }}Â¢
      </div>
    </div>

    <div
      *ngIf="
        game.room!.state.roundState == 'idle' &&
        game.room!.state.nextRoundStartTimestamp
      "
      class="row-start-1 col-start-1 z-10 table-font-xl pill-popup"
      data-cy="roundStart-popup"
    >
      Starting round
    </div>

    <div
      *ngIf="game.trumpSelectionPhase && game.isDealer"
      class="row-start-1 col-start-1 z-10 table-font-xl pill-popup"
    >
      Choose whether to keep trump card
    </div>

    <div
      *ngIf="game.knockInPhase"
      class="row-start-1 col-start-1 z-10 table-font-xl pill-popup"
    >
      <div
        *ngIf="game.room!.state.currentKnockPlayerId === game.room!.sessionId"
      >
        Your turn: Knock in to play this hand
      </div>
      <div
        *ngIf="game.room!.state.currentKnockPlayerId !== game.room!.sessionId"
      >
        Waiting for
        {{ getPlayerName(game.room!.state.currentKnockPlayerId) }} to knock
      </div>
    </div>
    <div
      *ngIf="game.room!.state.roundState === 'turns'"
      class="row-start-1 col-start-1 z-10 table-font-xl pill-popup"
    >
      <span *ngIf="game.playersTurn">Your turn - click a card</span>
      <span *ngIf="!game.playersTurn">
        {{ getCurrentPlayerName() }}'s turn
      </span>
    </div>
    <div
      *ngIf="game.room!.state.roundState === 'trick-complete'"
      class="row-start-1 col-start-1 z-10 table-font pill-popup"
    >
      Trick {{ game.room!.state.currentTrickNumber }} won by:
      {{ getTrickWinnerName() }}
    </div>
  </div>

  <app-player-actions
    class="sm:mt-6"
    [betMenuDisabled]="game.roundInProgress || game.player?.ready"
    [currentBet]="game.player?.bet || 0"
    (changeBet)="game.changeBet($event)"
    (setBet)="game.setBet($event)"
    [readyMenuHidden]="game.roundInProgress"
    [ready]="game.player?.ready"
    (readyChange)="game.setReadyState($event)"
    [autoReady]="game.player?.autoReady"
    (autoReadyChange)="game.setAutoReadyState($event)"
    [cardPlayPhase]="game.room!.state.roundState === 'turns'"
    [trumpSelectionMenuVisible]="game.trumpSelectionPhase && game.isDealer"
    [trumpCardDisplay]="getTrumpCardDisplay()"
    (keepTrump)="game.keepTrump($event)"
    [knockInMenuVisible]="
      game.knockInPhase &&
      !game.player?.hasKnockDecision &&
      game.room!.state.currentKnockPlayerId === game.room!.sessionId
    "
    [trumpSuit]="game.room!.state.trumpSuit"
    (knockIn)="game.knockIn($event)"
  ></app-player-actions>

  <span class="text-neutral-400 self-end" data-cy="roomId-value">
    Room ID: {{ game.room!.id }}
  </span>
</div>
