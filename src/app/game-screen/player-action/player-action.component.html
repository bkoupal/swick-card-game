<div class="flex flex-col-reverse sm:flex-col gap-4 m-4">
  <!-- SWICK Ante Setting (Dealer Only) - HIDE if players went set last round -->
  <div
    *ngIf="!readyMenuHidden && isDealer && !ready && !hasGoingSetBonus"
    class="grid gap-1"
  >
    <span class="text-center table-font">Set Ante (Dealer)</span>
    <div class="grid grid-cols-5 gap-1">
      <button
        *ngFor="let ante of allowedAntes"
        mat-flat-button
        [color]="currentBet === ante ? 'accent' : 'primary'"
        [disabled]="betMenuDisabled"
        (click)="setBet.emit(ante)"
        class="text-xs px-2 py-1"
      >
        {{ ante }}¢
      </button>
    </div>
    <div class="text-xs text-center text-gray-400 mt-1">
      Everyone antes {{ currentBet }}¢ + dealer pays {{ currentBet + 3 }}¢
    </div>
  </div>

  <!-- SWICK Going Set Bonus Display (Dealer Only) - SHOW when players went set -->
  <div
    *ngIf="!readyMenuHidden && isDealer && !ready && hasGoingSetBonus"
    class="grid gap-1"
  >
    <span class="text-center table-font text-yellow-400"
      >One or more players has gone set</span
    >
    <div
      class="text-center bg-red-900 rounded px-3 py-2 border-2 border-red-600"
    >
      <div class="text-lg font-bold text-red-300">
        {{ goingSetBonusAmount }}¢
      </div>
      <div class="text-xs text-red-400 mb-2">Total Set Amounts</div>
      <div class="text-sm text-yellow-300">
        Only dealer pays 3¢ ante this round
      </div>
    </div>
  </div>

  <!-- Trump Selection Menu (only for dealer) -->
  <div class="pill-menu" *ngIf="trumpSelectionMenuVisible">
    <!--span class="whitespace-normal">Trump Card: {{ trumpCardDisplay }}</span-->
    <button (click)="keepTrump.emit(true)" data-cy="keep-trump">
      Keep Trump
    </button>
    <button (click)="keepTrump.emit(false)" data-cy="discard-trump">
      Don't Keep Trump
    </button>
  </div>

  <!-- Dealer Knock In Menu (Special trump keeping logic) -->
  <div class="pill-menu" *ngIf="knockInMenuVisible && isDealer">
    <span *ngIf="dealerKeptTrump" class="text-yellow-400 text-sm">
      You kept: {{ dealerTrumpValue }} of {{ trumpSuit }}
    </span>
    <button (click)="knockIn.emit(true)" data-cy="dealer-knock-in">
      Knock In
    </button>
    <button
      (click)="knockIn.emit(false)"
      data-cy="dealer-pass"
      [class]="
        dealerSetType === 'double'
          ? 'bg-red-600 hover:bg-red-700'
          : 'bg-orange-600 hover:bg-orange-700'
      "
    >
      {{ dealerPassButtonText }}
    </button>
  </div>

  <!-- Non-Dealer Knock In Menu (Standard) -->
  <div class="pill-menu" *ngIf="knockInMenuVisible && !isDealer">
    <button (click)="knockIn.emit(true)" data-cy="knock-in">Knock In</button>
    <button (click)="knockIn.emit(false)" data-cy="pass">Pass</button>
  </div>

  <!-- Dealer Discard/Draw Menu - Didn't Keep Trump -->
  <div
    class="pill-menu"
    *ngIf="
      discardDrawMenuVisible &&
      isDealer &&
      !dealerKeptTrump &&
      !isDealerFinalDiscard
    "
  >
    <span class="whitespace-normal">
      Select cards from your hand, then choose:
    </span>
    <button
      (click)="playCards.emit()"
      data-cy="dealer-play-cards"
      class="bg-green-600 hover:bg-green-700"
    >
      Play These Cards
    </button>
    <button
      (click)="discardDraw.emit()"
      data-cy="dealer-discard-draw"
      [disabled]="selectedCardCount === 0"
      [class.opacity-50]="selectedCardCount === 0"
      [class.cursor-not-allowed]="selectedCardCount === 0"
    >
      Discard & Draw ({{ selectedCardCount }} cards)
    </button>
  </div>

  <!-- Dealer Discard/Draw Menu - Kept Trump -->
  <div
    class="pill-menu"
    *ngIf="
      discardDrawMenuVisible &&
      isDealer &&
      dealerKeptTrump &&
      !isDealerFinalDiscard
    "
  >
    <span class="whitespace-normal">
      Select cards from your hand, then choose:
    </span>
    <button
      (click)="playCards.emit()"
      data-cy="dealer-play-cards"
      class="bg-green-600 hover:bg-green-700"
    >
      Play These Cards
    </button>
    <button
      (click)="discardDraw.emit()"
      data-cy="dealer-discard-draw"
      [disabled]="selectedCardCount === 0"
      [class.opacity-50]="selectedCardCount === 0"
      [class.cursor-not-allowed]="selectedCardCount === 0"
    >
      Discard & Draw ({{ selectedCardCount }} cards)
    </button>
    <button
      (click)="dealerGoSet.emit(true)"
      data-cy="dealer-go-set"
      class="bg-orange-600 hover:bg-orange-700"
    >
      {{ dealerPassButtonText }}
    </button>
  </div>

  <!-- Dealer Final Discard Menu - Before Final Card Selection -->
  <div
    class="pill-menu"
    *ngIf="
      discardDrawMenuVisible &&
      isDealer &&
      isDealerFinalDiscard &&
      selectedCardCount !== 1
    "
  >
    <span class="whitespace-normal">
      Select 1 card to discard (you have 4 cards)
    </span>
    <button
      (click)="discardDraw.emit()"
      data-cy="dealer-final-discard"
      [disabled]="selectedCardCount !== 1"
      [class.opacity-50]="selectedCardCount !== 1"
      [class.cursor-not-allowed]="selectedCardCount !== 1"
    >
      Discard Selected Card
    </button>
    <button
      *ngIf="dealerKeptTrump"
      (click)="dealerGoSet.emit(true)"
      data-cy="dealer-final-go-set"
      class="bg-orange-600 hover:bg-orange-700"
    >
      {{ dealerFinalDecisionText }}
    </button>
  </div>

  <!-- Dealer Final Discard Menu - After Final Card Selection (Show I'm Playing) -->
  <div
    class="pill-menu"
    *ngIf="
      discardDrawMenuVisible &&
      isDealer &&
      isDealerFinalDiscard &&
      selectedCardCount === 1 &&
      dealerKeptTrump
    "
  >
    <span class="whitespace-normal">
      Ready to play with 3 cards, or go set?
    </span>
    <button
      (click)="discardDraw.emit()"
      data-cy="dealer-final-discard"
      class="bg-blue-600 hover:bg-blue-700"
    >
      Discard & Play
    </button>
    <button
      (click)="dealerGoSet.emit(true)"
      data-cy="dealer-final-go-set"
      class="bg-orange-600 hover:bg-orange-700"
    >
      {{ dealerFinalDecisionText }}
    </button>
  </div>

  <!-- Dealer Final Discard Menu - Didn't Keep Trump (Still can pass) -->
  <div
    class="pill-menu"
    *ngIf="
      discardDrawMenuVisible &&
      isDealer &&
      isDealerFinalDiscard &&
      !dealerKeptTrump
    "
  >
    <span class="whitespace-normal">
      Select 1 card to discard (you have 4 cards), then choose:
    </span>
    <button
      (click)="playCards.emit()"
      data-cy="dealer-final-play"
      class="bg-green-600 hover:bg-green-700"
    >
      I'm Playing
    </button>
    <button
      (click)="discardDraw.emit()"
      data-cy="dealer-final-discard"
      [disabled]="selectedCardCount !== 1"
      [class.opacity-50]="selectedCardCount !== 1"
      [class.cursor-not-allowed]="selectedCardCount !== 1"
    >
      Discard Selected Card
    </button>
    <button
      (click)="dealerGoSet.emit(true)"
      data-cy="dealer-final-pass"
      class="bg-gray-600 hover:bg-gray-700"
    >
      Pass
    </button>
  </div>

  <!-- Non-Dealer Discard/Draw Menu (Standard) -->
  <div class="pill-menu" *ngIf="discardDrawMenuVisible && !isDealer">
    <span class="whitespace-normal">
      Select cards from your hand, then choose:
    </span>
    <button
      (click)="playCards.emit()"
      data-cy="play-cards"
      class="bg-green-600 hover:bg-green-700"
    >
      Play These Cards
    </button>
    <button
      (click)="discardDraw.emit()"
      data-cy="discard-draw"
      [disabled]="selectedCardCount === 0"
      [class.opacity-50]="selectedCardCount === 0"
      [class.cursor-not-allowed]="selectedCardCount === 0"
    >
      Discard & Draw ({{ selectedCardCount }} cards)
    </button>
  </div>

  <div
    class="pill-menu"
    *ngIf="
      !readyMenuHidden && !trumpSelectionMenuVisible && !knockInMenuVisible
    "
  >
    <!-- Show "Waiting for dealer to set ante" for non-dealers when ante is default -->
    <div
      *ngIf="!isDealer && isWaitingForAnteSet"
      class="text-center text-yellow-400"
    >
      <div class="text-sm">Waiting for dealer</div>
      <div class="text-xs">to set ante amount</div>
    </div>

    <!-- Normal ready controls when ante is set -->
    <div
      *ngIf="isDealer || !isWaitingForAnteSet"
      class="flex items-center w-full"
    >
      <!-- UPDATED: Changed button text and behavior -->
      <button
        style="flex-grow: 100"
        (click)="readyChange.emit(!ready)"
        *ngIf="!ready"
      >
        I'm Ready to Play
      </button>

      <!-- Show a different state when ready - just a status indicator, not clickable -->
      <div
        *ngIf="ready"
        class="flex-grow text-center p-2 font-medium px-3 rounded-md bg-green-600 text-white"
      >
        ✓ Ready
      </div>
    </div>
  </div>

  <div
    class="pill-menu"
    *ngIf="
      readyMenuHidden &&
      !trumpSelectionMenuVisible &&
      !knockInMenuVisible &&
      cardPlayPhase &&
      isPlayersTurn
    "
  >
    <span class="whitespace-normal text-center">
      Click a card from your hand to play it
    </span>
  </div>
</div>
