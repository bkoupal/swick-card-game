<div
  class="rounded-lg p-1.5 2xl:p-2 grid place-items-center group z-10"
  [class.opacity-70]="type == 'player' && !player?.ready"
  [class.primary-border]="isPlayerTurn"
  [class.dealer-box]="isDealer"
  [class.bg-neutral-600]="!isDealer"
  [attr.data-cy]="player ? 'player' : null"
>
  <div
    *ngIf="player?.disconnected"
    class="col-start-1 row-start-1 pill-popup !py-1 scale-50 sm:scale-100"
  >
    <mat-icon
      class="text-yellow-400 align-middle mb-px"
      matTooltip="Player is disconnected"
      >warning</mat-icon
    >
  </div>

  <div class="flex flex-col col-start-1 row-start-1">
    <span
      [ngClass]="{
        'text-center': true,
        'whitespace-nowrap': true,
        'table-font-dealer-name': type === 'dealer',
        'table-font-player-name': type !== 'dealer'
      }"
      [attr.data-cy]="player ? 'player-name' : null"
      *ngIf="player"
    >
      {{ type == "dealer" ? "Dealer" : player.displayName || "No Player" }}
      <!-- BOT INDICATOR -->
      <div>
        <span
          *ngIf="player.isBot"
          class="text-blue-400 ml-1"
          [matTooltip]="getBotTooltip()"
          matTooltipPosition="above"
        >
          ğŸ¤–
        </span>

        <!-- Going Set Indicators -->
        <span
          *ngIf="player.wentSet && player.setType === 'single'"
          class="text-red-400 ml-1"
          matTooltip="Went Set Single - owes {{ player.setAmount }}Â¢"
        >
          ğŸ’¸
        </span>
        <span
          *ngIf="player.wentSet && player.setType === 'double'"
          class="text-red-600 ml-1"
          matTooltip="Went Set Double - owes {{ player.setAmount }}Â¢"
        >
          ğŸ’¸ğŸ’¸
        </span>

        <!-- Tricks Won Indicator (during/after rounds) -->
        <span
          *ngIf="shouldShowTricksWon()"
          class="text-yellow-400 text-xs ml-1"
          matTooltip="{{ player.tricksWon }} trick(s) won"
        >
          ğŸ†{{ player.tricksWon }}
        </span>
      </div>
    </span>

    <app-money-counter
      *ngIf="player"
      [money]="player.money"
    ></app-money-counter>

    <!-- The progress bar is for turn timeout - shows time remaining for player's turn -->
    <!-- app-timestamp-progress-bar
      *ngIf="player"
      class="scale-y-150"
      [endTimestamp]="isPlayerTurn ? endTimestamp : 0"
    ></app-timestamp-progress-bar -->

    <!-- ADD DEALER LABEL BELOW NAME -->
    <!-- div
      *ngIf="isDealer && gameState?.roundState !== 'idle'" >
      class="table-font text-xs bg-red-600 text-white px-2 py-1 rounded-full text-center font-bold mt-1"
    >
      DEALER
    </div -->
    <div
      *ngIf="isDealer"
      class="table-font text-xs bg-red-600 text-white px-2 py-1 rounded-full text-center font-bold mt-1"
    >
      DEALER
    </div>

    <!-- PASSED INDICATOR - Shows when cards are hidden with FIXED WIDTH -->
    <div
      *ngIf="hasPlayerPassed()"
      class="col-start-1 row-start-1 flex items-center justify-center"
    >
      <div
        class="table-font text-sm bg-gray-600 text-white px-3 py-1 rounded-md text-center font-bold opacity-90 whitespace-nowrap"
        style="
          width: fit-content;
          max-width: calc(var(--playing-card-width) * 1.5);
        "
      >
        PASSED
      </div>
    </div>
  </div>

  <button
    *ngIf="player && clientIsAdmin && !clientIsPlayer && !player.disconnected"
    mat-mini-fab
    color="primary"
    matTooltip="Kick this player."
    [matTooltipPosition]="'above'"
    class="mr-auto mb-auto -ml-7 -mt-7 col-start-1 row-start-1 invisible group-hover:visible scale-50 sm:scale-75"
    (click)="kick.next(player.sessionId)"
  >
    <mat-icon>close</mat-icon>
  </button>
</div>

<div class="card-holder absolute z-10">
  <app-hand-score
    class="absolute left-1/2 -translate-x-1/2 bottom-full"
    [hand]="hand"
    *ngIf="!scoreBottom"
  ></app-hand-score>

  <div class="grid place-items-center">
    <!-- Round outcome popup -->
    <!--div
      *ngIf="player?.roundOutcome || dealerHand?.isBusted"
      class="z-10 table-font pill-popup col-start-1 row-start-1 whitespace-nowrap text-center"
      data-cy="roundOutcome"
    >
      {{
        player
          ? clientIsPlayer
            ? roundOutcomeToDisplayMessageCurrentPlayer[player.roundOutcome]
            : roundOutcomeToDisplayMessage[player.roundOutcome]
          : "Busted"
      }}
    </div -->

    <!-- Cards display - HIDE COMPLETELY if player passed -->
    <div
      *ngIf="!hasPlayerPassed()"
      class="flex col-start-1 row-start-1 transition-opacity duration-1000"
      [class.opacity-80]="player?.roundOutcome || dealerHand?.isBusted"
    >
      <div class="hand">
        <app-card
          *ngFor="let card of hand?.cards; let i = index"
          [card]="shouldShowCards() ? card : getHiddenCard(card)"
          [isClickable]="canPlayCard(card)"
          [isTrumpCard]="isTrumpCard(card)"
          [trumpSuit]="gameState?.trumpSuit || ''"
          [dealerKeptThisCard]="isDealerKeptTrumpCard(card)"
          (cardClick)="onCardClick(i)"
        >
        </app-card>
      </div>
      <div style="width: calc(var(--playing-card-width) * 0.5)"></div>
    </div>
  </div>

  <!-- Bottom hand score -->
  <app-hand-score
    class="absolute left-1/2 -translate-x-1/2"
    [hand]="hand"
    *ngIf="scoreBottom"
  ></app-hand-score>
</div>
