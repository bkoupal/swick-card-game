<!-- src/app/lobby/lobby.component.html - FIXED VERSION -->
<div class="lobby-container">
  <div class="lobby-header">
    <h1 class="lobby-title">‚ô†Ô∏è ‚ô•Ô∏è SWICK Game Lobby ‚ô£Ô∏è ‚ô¶Ô∏è</h1>
    <p class="lobby-subtitle">Join an existing game or create your own</p>
  </div>

  <!-- Player Name Input -->
  <div class="player-setup">
    <div class="name-section">
      <mat-form-field appearance="outline" class="player-name-field">
        <mat-label>Your Name</mat-label>
        <input
          matInput
          [formControl]="playerName"
          placeholder="Enter your player name"
          maxlength="20"
        />
        <button
          mat-icon-button
          matSuffix
          (click)="generateRandomName()"
          matTooltip="Generate random name"
        >
          <mat-icon>shuffle</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <!-- FIXED: Private Game Toggle -->
    <div class="privacy-section">
      <mat-slide-toggle
        [checked]="isPrivateGame"
        (change)="isPrivateGame = $event.checked"
        class="private-toggle"
        color="accent"
      >
        <span class="toggle-label">
          <mat-icon>{{ isPrivateGame ? "lock" : "public" }}</mat-icon>
          {{ isPrivateGame ? "Private Game" : "Public Game" }}
        </span>
      </mat-slide-toggle>
      <p class="privacy-description">
        {{ getQuickGameDescription() }}
      </p>
    </div>

    <!-- Quick Create Section -->
    <div class="create-section">
      <button
        mat-raised-button
        color="primary"
        (click)="createRoom()"
        [disabled]="isLoading || playerName.invalid"
        class="create-btn quick-create"
      >
        <mat-icon>{{ isPrivateGame ? "lock" : "add" }}</mat-icon>
        {{ isPrivateGame ? "Create Private Game" : "Quick Game" }}
      </button>

      <button
        mat-button
        (click)="toggleAdvancedCreation()"
        class="toggle-advanced"
        [matTooltip]="getAdvancedOptionsDescription()"
      >
        <mat-icon>{{
          showAdvancedCreation ? "expand_less" : "expand_more"
        }}</mat-icon>
        Advanced Options
      </button>
    </div>

    <!-- Advanced Game Creation -->
    <div class="advanced-creation" *ngIf="showAdvancedCreation">
      <div class="advanced-header">
        <h3>Game Setup</h3>
      </div>

      <!-- Total Players -->
      <div class="setting-group">
        <label class="setting-label">Total Players (3-6):</label>
        <div class="player-count-buttons">
          <button
            *ngFor="let count of [3, 4, 5, 6]"
            mat-raised-button
            [color]="totalPlayers === count ? 'accent' : 'basic'"
            (click)="setTotalPlayers(count)"
            class="count-btn"
          >
            {{ count }}
          </button>
        </div>
      </div>

      <!-- Player Type Selection -->
      <div class="setting-group" *ngIf="totalPlayers > 1">
        <label class="setting-label">Player Types:</label>

        <!-- Player 1 (always you) -->
        <div class="player-slot">
          <span class="player-label">Player 1:</span>
          <span class="player-type-fixed">üë§ You (Human)</span>
        </div>

        <!-- Additional players -->
        <div
          *ngFor="let idx of getPlayerSlots(); let i = index"
          class="player-slot"
        >
          <span class="player-label">Player {{ idx + 1 }}:</span>
          <div class="player-type-buttons">
            <button
              mat-raised-button
              [color]="playerTypes[i] === 'human' ? 'primary' : 'basic'"
              (click)="setPlayerType(i, 'human')"
              class="type-btn"
            >
              üë§ Human
            </button>
            <button
              mat-raised-button
              [color]="playerTypes[i] === 'bot' ? 'accent' : 'basic'"
              (click)="setPlayerType(i, 'bot')"
              class="type-btn"
            >
              ü§ñ Bot
            </button>
          </div>
        </div>
      </div>

      <!-- Bot Difficulty (only show if any bots selected) -->
      <div class="setting-group" *ngIf="hasAnyBots()">
        <label class="setting-label">Bot Difficulty:</label>
        <div class="difficulty-buttons">
          <button
            mat-raised-button
            [color]="botDifficulty === 'easy' ? 'accent' : 'basic'"
            (click)="setBotDifficulty('easy')"
            class="difficulty-btn"
          >
            Easy
          </button>
          <button
            mat-raised-button
            [color]="botDifficulty === 'medium' ? 'accent' : 'basic'"
            (click)="setBotDifficulty('medium')"
            class="difficulty-btn"
          >
            Medium
          </button>
          <button
            mat-raised-button
            [color]="botDifficulty === 'hard' ? 'accent' : 'basic'"
            (click)="setBotDifficulty('hard')"
            class="difficulty-btn"
          >
            Hard
          </button>
        </div>
      </div>

      <!-- Game Summary -->
      <div class="game-summary">
        <mat-icon>info</mat-icon>
        <span>{{ getGameSummary() }}</span>
      </div>

      <!-- Create Advanced Room Button -->
      <button
        mat-raised-button
        color="primary"
        (click)="createAdvancedRoom()"
        [disabled]="isLoading || playerName.invalid"
        class="create-btn advanced-create"
      >
        <mat-icon>{{ isPrivateGame ? "lock" : "rocket_launch" }}</mat-icon>
        {{
          isPrivateGame ? "Create Private Custom Game" : "Create Custom Game"
        }}
      </button>
    </div>
  </div>

  <!-- Error Display -->
  <div class="error-display" *ngIf="error">
    <mat-icon>error</mat-icon>
    <span>{{ error }}</span>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-section" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <span>Loading...</span>
  </div>

  <!-- Room Listings -->
  <div class="room-listings">
    <div class="listings-header">
      <h2>Available Games</h2>
      <button
        mat-icon-button
        (click)="loadRoomListings()"
        [disabled]="isLoading"
        matTooltip="Refresh room list"
      >
        <mat-icon>refresh</mat-icon>
      </button>
    </div>

    <div class="rooms-grid" *ngIf="roomListings.length > 0; else noRooms">
      <div
        *ngFor="let room of roomListings"
        class="room-card"
        [class.room-joinable]="canJoinRoom(room)"
        [class.room-locked]="!canJoinRoom(room)"
      >
        <!-- Room Header -->
        <div class="room-header">
          <h3 class="room-name">{{ room.name }}</h3>
          <span class="room-id">ID: {{ room.roomId }}</span>
          <span
            class="room-status"
            [ngClass]="getStatusClass(room.metadata.gameStatus)"
          >
            {{ room.metadata.gameStatus }}
          </span>
        </div>

        <!-- Room Details -->
        <div class="room-details">
          <!-- FIXED: Player count display -->
          <div class="detail-item">
            <mat-icon>people</mat-icon>
            <span
              >{{ room.metadata.currentPlayers || room.clients }}/{{
                room.maxClients
              }}
              players</span
            >
          </div>

          <div class="detail-item" *ngIf="room.metadata.readyPlayers > 0">
            <mat-icon>check_circle</mat-icon>
            <span>{{ room.metadata.readyPlayers }} ready</span>
          </div>

          <div class="detail-item" *ngIf="room.metadata.potValue > 0">
            <mat-icon>monetization_on</mat-icon>
            <span>{{ room.metadata.potValue }}¬¢ pot</span>
          </div>

          <div class="detail-item" *ngIf="room.metadata.dealerName">
            <mat-icon>person_pin</mat-icon>
            <span>Dealer: {{ room.metadata.dealerName }}</span>
          </div>
        </div>

        <!-- Room Actions -->
        <div class="room-actions">
          <button
            mat-raised-button
            *ngIf="canJoinRoom(room)"
            color="primary"
            (click)="joinRoom(room)"
            [disabled]="isLoading || playerName.invalid"
          >
            <mat-icon>login</mat-icon>
            Join Game
          </button>

          <div *ngIf="!canJoinRoom(room)" class="join-disabled-reason">
            <mat-icon>block</mat-icon>
            {{ getJoinErrorMessage(room) }}
          </div>
        </div>
      </div>
    </div>

    <ng-template #noRooms>
      <div class="no-rooms">
        <mat-icon>games</mat-icon>
        <p>No games available</p>
        <p class="no-rooms-subtitle">Create a game to get started!</p>
      </div>
    </ng-template>
  </div>
</div>
